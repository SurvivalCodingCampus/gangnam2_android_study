## Hilt

### Hilt 정의

> Hilt는 Android 환경에 최적화된 DI(의존성 주입) 프레임워크로, 객체 생성과 의존성 연결 책임을 프레임워크가 대신 수행하도록 만든 도구

- Dagger 기반 (컴파일 타임 DI)
- Android 컴포넌트 생명주기와 강하게 결합
- 표준화된 방식 제공 → 실수 줄이기 목적

#### Hilt 사용하지 않을 경우

```kotlin
val repository = RecipeRepositoryImpl(
    MockRecipeDataSourceImpl(),
    MockIngredientDataSourceImpl()
)
val viewModel = HomeViewModel(repository)
```

- 객체 생성 코드가 여기저기 흩어짐
    - 교체/테스트 어려움
    - Application, Context에 의존하게 됨
    - ViewModelFactory 사용

> Hilt는 이 문제를 “생성 책임 분리”로 해결

### Hilt 핵심 개념

#### 생성 책임 위임

- ❌ 내가 new 하지 않는다
- ❌ 내가 Factory를 만들지 않는다
- ✅ Hilt가 대신 생성
    ```kotlin
    @HiltViewModel
    class HomeViewModel @Inject constructor(
        private val recipeRepository: RecipeRepository
    ) : ViewModel()
    ```

#### 의존성 그래프 (Dependency Graph)

- Hilt는 내부적으로 그래프를 만든다.
- 필요한 게 있으면 그래프를 따라 내려가서 없으면 생성, 있으면 재사용
- 개발자는 연결만 선언
    ```markdown
    HomeViewModel
    └── RecipeRepository
    └── RecipeDataSource
    ```

#### Scope(생명주기) 관리

- Hilt는 Android 생명주기 단위로 scope를 제공
  | Scope | 의미 |
  | -------------------- | -------------- |
  | `@Singleton`         | 앱 전체에서 하나 |
  | `ViewModelComponent` | ViewModel 생명주기 |
  | `ActivityComponent`  | Activity 생명주기 |

- 언제 생성되고 언제 파괴될지 Hilt가 관리
    ```kotlin
    @Provides
    @Singleton
    fun provideRepository(): RecipeRepository
    ```

### Hilt 에서 자주 쓰이는 어노테이션

#### @HiltAndroidApp

```kotlin
@HiltAndroidApp
class AppApplication : Application()
```

- Hilt 시작점
- DI 컨테이너 생성
- 반드시 1개

#### @AndroidEntryPoint

```kotlin
@AndroidEntryPoint
class MainActivity : ComponentActivity()
```

- Hilt가 객체를 주입할 수 있는 진입점
- Activity / Fragment / Composable Host

#### @HiltViewModel

```kotlin
@HiltViewModel
class HomeViewModel @Inject constructor(...) : ViewModel()
```

- ViewModel 전용 annotation
- ViewModel 생명주기와 연동

#### @Inject constructor

```kotlin
class ToggleBookmarkUseCase @Inject constructor(
    private val bookmarkRepository: BookmarkRepository
)
```

- 이 클래스는 Hilt가 생성할 수 있다”
- 생성자에 필요한 의존성 명시

#### @Module + @Provides

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object RepositoryModule {

    @Provides
    fun provideRepository(...): RecipeRepository
}
```

- 생성자가 복잡할 때
- 외부 라이브러리 객체 제공
- 인터페이스 바인딩

### Hilt에서 ViewModel 사용하는 흐름

- Application

```kotlin
@HiltAndroidApp
class AppApplication : Application()
```

- Activity

```kotlin
@AndroidEntryPoint
class MainActivity : ComponentActivity()
```

- ViewModel

```kotlin
@HiltViewModel
class HomeViewModel @Inject constructor(...) : ViewModel()
```

- Composable Screen(Root)

```kotlin
val viewModel: HomeViewModel = hiltViewModel()
```

#### Hilt에서 “하면 안 되는 것”

- ❌ ViewModelFactory 직접 작성
- ❌ Application에서 의존성 꺼내기
- ❌ ViewModel 내부에서 Context 직접 참조
- ❌ 화면 전환 시 의존성 전달